```excel
=LET(
  topics; B1:Z1;
  scores; B31:Z31;
  approval_rates; MAP(topics; scores; LAMBDA(topic; score;
    IF(OR(topic=""; score=""); IFERROR(1/0);
      LET(
        voters; COUNTA(INDEX($B$2:$Z$30; 0; MATCH(topic; topics; 0)));
        IF(voters=0; IFERROR(1/0); score / (voters * 10))
      )
    )
  ));
  valid_topics; FILTER(topics; ISNUMBER(approval_rates));
  valid_approvals; FILTER(approval_rates; ISNUMBER(approval_rates));
  SORT(TRANSPOSE({valid_approvals; valid_topics}); 1; FALSE)
)
```

## Описание

Эта формула создает единый динамический рейтинг, который выводит два столбца: "Одобрение" и "Тема", отсортированные по убыванию процента одобрения. В рейтинг попадают только те темы, которые имеют название и получили хотя бы один голос.

1.  **Расчет массива процентов одобрения (`approval_rates`) и предварительная фильтрация**: Формула создает виртуальный массив `approval_rates`, проходя по каждому элементу в исходных диапазонах `topics` (названия тем из B1:Z1) и `scores` (суммарные оценки из B31:Z31). Для каждой пары "тема-оценка" выполняются следующие проверки:
    *   **Проверка на валидность**: Если текущая тема (`topic`) или ее суммарная оценка (`score`) пустые, столбец помечается для удаления.
    *   **Подсчет проголосовавших (`voters`)**: Для каждой валидной темы подсчитывается точное количество участников, поставивших оценку. При этом:
        *   **Пустая ячейка** означает, что участник не голосовал, и он не учитывается в `voters`.
        *   **Оценка `0`** считается голосом и учитывается в `voters`.
    *   **Расчет одобрения**: Если количество проголосовавших (`voters`) больше нуля, вычисляется процент одобрения по формуле: `score / (voters * 10)`. Если `voters = 0`, столбец также помечается для удаления.
2.  **Финальная очистка (создание списков `valid_topics` и `valid_approvals`)**: На основе массива `approval_rates` создаются два "чистых" списка. В `valid_topics` (валидные темы) попадают только названия тем, а в `valid_approvals` (валидные проценты одобрения) — соответствующие им проценты одобрения, которые успешно прошли все проверки на шаге 1.
3.  **Сборка и сортировка**: "Чистые" списки `valid_approvals` и `valid_topics` объединяются в итоговую таблицу, которая затем сортируется по первому столбцу (одобрение) в порядке убывания.

В результате получается единый, всегда актуальный рейтинг, отсортированный по самому важному показателю и очищенный от нерелевантных данных.
